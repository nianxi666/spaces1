# æ”¯ä»˜APIæµ‹è¯•æŒ‡å—

## ğŸ¯ æ¦‚è¿°

è¿™ä¸ªæµ‹è¯•æŒ‡å—å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸èŠ±ä¸€åˆ†é’±çš„æƒ…å†µä¸‹æµ‹è¯•æ”¯ä»˜APIçš„åŠŸèƒ½ã€‚æˆ‘ä¸ºä½ åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•ç«¯ç‚¹ï¼Œå¯ä»¥æ¨¡æ‹Ÿå®Œæ•´çš„æ”¯ä»˜æµç¨‹ã€‚

## ğŸ› ï¸ æµ‹è¯•ç«¯ç‚¹è¯´æ˜

### 1. åˆ›å»ºæµ‹è¯•è®¢å•
- **ç«¯ç‚¹**: `POST /api/payment/test/create-order`
- **åŠŸèƒ½**: åˆ›å»ºä¸€ä¸ªçŠ¶æ€ä¸º"pending"ï¼ˆæœªæ”¯ä»˜ï¼‰çš„æµ‹è¯•è®¢å•
- **è®¤è¯**: éœ€è¦Bearer Token

### 2. æŸ¥è¯¢è®¢å•åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/payment/test/orders`
- **åŠŸèƒ½**: æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•ï¼ˆåŒ…æ‹¬æµ‹è¯•è®¢å•ï¼‰
- **è®¤è¯**: éœ€è¦Bearer Token

### 3. æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
- **ç«¯ç‚¹**: `POST /api/payment/test/simulate-payment/<order_id>`
- **åŠŸèƒ½**: å°†æŒ‡å®šè®¢å•çŠ¶æ€æ”¹ä¸º"paid"å¹¶å‡çº§ä¼šå‘˜
- **è®¤è¯**: éœ€è¦Bearer Token

### 4. æ¸…ç†æµ‹è¯•è®¢å•
- **ç«¯ç‚¹**: `DELETE /api/payment/test/cleanup`
- **åŠŸèƒ½**: åˆ é™¤æ‰€æœ‰æµ‹è¯•è®¢å•
- **è®¤è¯**: éœ€è¦Bearer Token

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### æ–¹æ³•1: ä½¿ç”¨æµ‹è¯•è„šæœ¬

1. **è·å–ä½ çš„APIå¯†é’¥**:
   - ç™»å½•ç³»ç»Ÿ
   - è¿›å…¥ä¸ªäººèµ„æ–™é¡µé¢
   - å¤åˆ¶APIå¯†é’¥

2. **ä¿®æ”¹æµ‹è¯•è„šæœ¬**:
   ```bash
   # ç¼–è¾‘ test_payment_api.py
   API_KEY = "ä½ çš„APIå¯†é’¥"
   BASE_URL = "http://localhost:5000"  # æˆ–ä½ çš„æœåŠ¡å™¨åœ°å€
   ```

3. **è¿è¡Œæµ‹è¯•**:
   ```bash
   python test_payment_api.py
   ```

### æ–¹æ³•2: æ‰‹åŠ¨æµ‹è¯•ï¼ˆä½¿ç”¨curlï¼‰

#### 1. åˆ›å»ºæµ‹è¯•è®¢å•
```bash
curl -X POST http://localhost:5000/api/payment/test/create-order \
  -H "Authorization: Bearer ä½ çš„APIå¯†é’¥" \
  -H "Content-Type: application/json" \
  -d '{"amount": "5.00", "currency": "USD"}'
```

#### 2. æŸ¥è¯¢è®¢å•åˆ—è¡¨
```bash
curl -X GET http://localhost:5000/api/payment/test/orders \
  -H "Authorization: Bearer ä½ çš„APIå¯†é’¥"
```

#### 3. æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
```bash
# å°†ä¸‹é¢çš„TEST_ORDER_IDæ›¿æ¢ä¸ºå®é™…çš„è®¢å•å·
curl -X POST http://localhost:5000/api/payment/test/simulate-payment/TEST_ORDER_ID \
  -H "Authorization: Bearer ä½ çš„APIå¯†é’¥"
```

#### 4. æ¸…ç†æµ‹è¯•è®¢å•
```bash
curl -X DELETE http://localhost:5000/api/payment/test/cleanup \
  -H "Authorization: Bearer ä½ çš„APIå¯†é’¥"
```

## ğŸ“Š é¢„æœŸç»“æœ

### åˆ›å»ºè®¢å•å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æµ‹è¯•è®¢å•åˆ›å»ºæˆåŠŸ",
  "order": {
    "order_id": "TEST_ABC123456789",
    "username": "your_username",
    "email": "your_username@test.com",
    "amount": "5.00",
    "currency": "USD",
    "status": "pending",
    "created_at": "2024-01-01T12:00:00",
    "is_test": true
  }
}
```

### æŸ¥è¯¢è®¢å•å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "username": "your_username",
  "orders": [
    {
      "order_id": "TEST_ABC123456789",
      "username": "your_username",
      "email": "your_username@test.com",
      "amount": "5.00",
      "currency": "USD",
      "status": "pending",
      "created_at": "2024-01-01T12:00:00",
      "is_test": true
    }
  ],
  "total_count": 1
}
```

### æ¨¡æ‹Ÿæ”¯ä»˜å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "message": "æ”¯ä»˜æ¨¡æ‹ŸæˆåŠŸï¼Œä¼šå‘˜å·²å‡çº§",
  "order": {
    "order_id": "TEST_ABC123456789",
    "status": "paid",
    "paid_at": "2024-01-01T12:05:00"
  },
  "membership_expiry": "2024-02-01T12:00:00"
}
```

## ğŸ” éªŒè¯æµ‹è¯•ç»“æœ

### 1. åœ¨å‰ç«¯é¡µé¢éªŒè¯
- ç™»å½•ç³»ç»Ÿ
- è¿›å…¥ä¸ªäººèµ„æ–™é¡µé¢
- æŸ¥çœ‹"è®¢å•è®°å½•"éƒ¨åˆ†
- ç¡®è®¤è®¢å•çŠ¶æ€å’Œä¼šå‘˜çŠ¶æ€

### 2. åœ¨æ•°æ®åº“éªŒè¯
```bash
# æŸ¥çœ‹æ•°æ®åº“å†…å®¹
python -c "from project.database import load_db; import json; db = load_db(); print(json.dumps(db.get('orders', []), indent=2))"
```

## ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®

æµ‹è¯•å®Œæˆåï¼Œè®°å¾—æ¸…ç†æµ‹è¯•æ•°æ®ï¼š

1. **ä½¿ç”¨æ¸…ç†ç«¯ç‚¹**:
   ```bash
   curl -X DELETE http://localhost:5000/api/payment/test/cleanup \
     -H "Authorization: Bearer ä½ çš„APIå¯†é’¥"
   ```

2. **æˆ–è€…æ‰‹åŠ¨åˆ é™¤**:
   - ç™»å½•ç®¡ç†å‘˜åå°
   - è¿›å…¥æ”¯ä»˜è®¾ç½®é¡µé¢
   - æ‰‹åŠ¨åˆ é™¤æµ‹è¯•è®¢å•

## ğŸ‰ æµ‹è¯•å®Œæˆ

æ­å–œï¼ä½ ç°åœ¨å¯ä»¥ï¼š
- âœ… åˆ›å»ºæœªæ”¯ä»˜çš„æµ‹è¯•è®¢å•
- âœ… æŸ¥è¯¢è®¢å•çŠ¶æ€
- âœ… æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
- âœ… éªŒè¯ä¼šå‘˜å‡çº§
- âœ… æ¸…ç†æµ‹è¯•æ•°æ®

æ‰€æœ‰è¿™äº›éƒ½ä¸éœ€è¦èŠ±ä¸€åˆ†é’±ï¼

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•è®¢å•æ ‡è®°**: æ‰€æœ‰æµ‹è¯•è®¢å•éƒ½æœ‰ `is_test: true` æ ‡è®°
2. **è®¢å•å·æ ¼å¼**: æµ‹è¯•è®¢å•å·ä»¥ "TEST_" å¼€å¤´
3. **ä¼šå‘˜å‡çº§**: æ¨¡æ‹Ÿæ”¯ä»˜ä¼šçœŸçš„å‡çº§ä¼šå‘˜30å¤©ï¼Œè¯·è°¨æ…æµ‹è¯•
4. **æ¸…ç†æ•°æ®**: æµ‹è¯•å®Œæˆåè¯·åŠæ—¶æ¸…ç†æµ‹è¯•æ•°æ®
5. **APIå¯†é’¥**: è¯·ä½¿ç”¨ä½ è‡ªå·±çš„APIå¯†é’¥è¿›è¡Œæµ‹è¯•

## ğŸ†˜ æ•…éšœæ’é™¤

### 401 é”™è¯¯
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®
- ç¡®è®¤Bearer Tokenæ ¼å¼æ­£ç¡®

### 403 é”™è¯¯
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
- ç¡®è®¤APIå¯†é’¥æ˜¯å¦å±äºå½“å‰ç”¨æˆ·

### 404 é”™è¯¯
- æ£€æŸ¥è®¢å•IDæ˜¯å¦æ­£ç¡®
- ç¡®è®¤è®¢å•æ˜¯å¦å±äºå½“å‰ç”¨æˆ·

### å…¶ä»–é”™è¯¯
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

ç¥ä½ æµ‹è¯•æ„‰å¿«ï¼ğŸŠ