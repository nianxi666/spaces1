# ğŸš¨ AI æ€è€ƒåŠŸèƒ½ - å…³é”®è¯Šæ–­

**å¦‚æœä»ç„¶çœ‹ä¸åˆ°æ€è€ƒå†…å®¹ï¼Œè¯·æŒ‰ç…§è¿™ä¸ªæ–‡æ¡£æ“ä½œ**

---

## âš ï¸ æœ€å¯èƒ½çš„åŸå› 

æ ¹æ®é—®é¢˜ç—‡çŠ¶ï¼Œæˆ‘åˆ—å‡ºæœ€å¯èƒ½çš„åŸå› ï¼ˆæŒ‰æ¦‚ç‡æ’åºï¼‰ï¼š

### åŸå›  1: NetMind API é…ç½®ä¸æ­£ç¡®æˆ–ä¸æ”¯æŒ (æ¦‚ç‡: 70%)

**ç—‡çŠ¶**: æ— è®ºå¦‚ä½•éƒ½çœ‹ä¸åˆ°æ€è€ƒå†…å®¹

**åŸå› **:
- API å¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸ
- Base URL é”™è¯¯
- é€‰æ‹©çš„æ¨¡å‹ä¸æ”¯æŒæ¨ç†
- NetMind è´¦æˆ·é…é¢å·²æ»¡

**éªŒè¯æ–¹æ³•**:
```bash
python3 check_reasoning_flow.py
# è¾“å…¥ä½ çš„ API Key å’Œ Base URL
# æŸ¥çœ‹æ˜¯å¦èƒ½è·å– reasoning_content
```

**å¦‚æœå·¥å…·è¾“å‡º**:
```
âœ— æ–¹æ³•1 (hasattr): æœªæ‰¾åˆ°
âœ— æ–¹æ³•2 (__dict__): æœªæ‰¾åˆ°
âœ— æ–¹æ³•3 (model_dump): æœªæ‰¾åˆ°
âœ— reasoning_content ä¸åœ¨ JSON ä¸­
âœ— æµä¸­æœªæ‰¾åˆ° reasoning_content
```

â†’ **ç»“è®º**: API ä¸è¿”å› reasoning_contentï¼Œé—®é¢˜åœ¨ API ä¾§

**è§£å†³æ–¹æ¡ˆ**:
1. è”ç³» NetMind æ”¯æŒ
2. æ£€æŸ¥è´¦æˆ·é…é¢å’Œé…ç½®
3. å°è¯•å…¶ä»–æ¨¡å‹

### åŸå›  2: æµè§ˆå™¨ç¼“å­˜é—®é¢˜ (æ¦‚ç‡: 15%)

**ç—‡çŠ¶**: ä»£ç å·²æ›´æ–°ä½†ä»æœªæ˜¾ç¤º

**éªŒè¯æ–¹æ³•**:
```
æŒ‰ F12 æ‰“å¼€å¼€å‘å·¥å…·
Network æ ‡ç­¾ä¸­æŸ¥çœ‹ API å“åº”
æŸ¥çœ‹æ˜¯å¦çœŸçš„åŒ…å« reasoning_content å­—æ®µ
```

**è§£å†³æ–¹æ¡ˆ**:
```
Ctrl+Shift+Delete (Windows/Linux)
Cmd+Shift+Delete (macOS)
é€‰æ‹©"å…¨éƒ¨æ—¶é—´"ï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜
```

### åŸå›  3: åº”ç”¨æ²¡æœ‰æ­£ç¡®å¤„ç†æ•°æ® (æ¦‚ç‡: 10%)

**ç—‡çŠ¶**: API æœ‰æ•°æ®ä½†åº”ç”¨æ²¡å¤„ç†

**éªŒè¯æ–¹æ³•**:
1. é‡å¯åº”ç”¨
2. æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ [DEBUG] è¾“å‡º
3. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
systemctl restart your-app-service
journalctl -u your-app-service -f
# åœ¨èŠå¤©ä¸­å‘é€æ¶ˆæ¯
# æŸ¥çœ‹ [DEBUG] æ—¥å¿—è¾“å‡º
```

### åŸå›  4: å‰ç«¯ä»£ç é—®é¢˜ (æ¦‚ç‡: 5%)

**ç—‡çŠ¶**: æ•°æ®åˆ°è¾¾å‰ç«¯ä½†ä¸æ˜¾ç¤º

**éªŒè¯æ–¹æ³•**:
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12 â†’ Console)
2. æŸ¥çœ‹æ˜¯å¦æœ‰ JavaScript é”™è¯¯
3. æ£€æŸ¥ç½‘ç»œæ ‡ç­¾çš„å“åº”

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: è·å–æœ€æ–°ä»£ç 
```bash
cd /home/engine/project
git pull origin fix-ai-thinking-support-remove-leaked-api-key
```

### æ­¥éª¤ 2: éªŒè¯ä»£ç 
```bash
python3 -m py_compile project/netmind_proxy.py project/api.py
# åº”è¯¥çœ‹åˆ°: æ— è¾“å‡ºï¼ˆè¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼‰
```

### æ­¥éª¤ 3: é‡å¯åº”ç”¨
```bash
systemctl restart your-app-service
# æˆ–
pkill -f "python run.py"
python run.py
```

### æ­¥éª¤ 4: è¿è¡Œè¯Šæ–­
```bash
# æ–¹å¼ A: ç›´æ¥æ£€æŸ¥ API
python3 check_reasoning_flow.py

# æ–¹å¼ B: æ£€æŸ¥åº”ç”¨
journalctl -u your-app-service -f
# åœ¨èŠå¤©ä¸­å‘é€æ¶ˆæ¯ï¼ŒæŸ¥çœ‹ [DEBUG] è¾“å‡º
```

### æ­¥éª¤ 5: æ¸…é™¤ç¼“å­˜
```
æ‰“å¼€æµè§ˆå™¨
Ctrl+Shift+Delete
é€‰æ‹©"å…¨éƒ¨æ—¶é—´"
ç‚¹å‡»"æ¸…é™¤"
```

### æ­¥éª¤ 6: é‡æ–°æµ‹è¯•
1. åˆ·æ–°æµè§ˆå™¨
2. é€‰æ‹© deepseek-ai/DeepSeek-R1 æ¨¡å‹
3. å‘é€æ¶ˆæ¯å¦‚: "è¯·ç”¨5ä¸ªæ­¥éª¤è§£é‡Šä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„"
4. è§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹

---

## ğŸ“Š ä½¿ç”¨ check_reasoning_flow.py è¯Šæ–­

### è¿è¡Œæ–¹å¼
```bash
python3 check_reasoning_flow.py
```

### è¾“å…¥è¦æ±‚
1. **API Key**: ä½ çš„ NetMind API å¯†é’¥
2. **Base URL**: é€šå¸¸æ˜¯ https://api.netmind.ai/inference-api/openai/v1

### è§£è¯»è¾“å‡º

#### âœ“ è‰¯å¥½çš„è¾“å‡º
```
âœ“ OpenAI SDK å·²å®‰è£…
âœ“ API è¿æ¥æˆåŠŸ
âœ“ æ–¹æ³•1 (hasattr): æ‰¾åˆ° = True
âœ“ æ–¹æ³•3 (model_dump): æ‰¾åˆ° = True
âœ“ reasoning_content åœ¨ JSON ä¸­: <think>...
âœ“ åŒ…å« reasoning_content: <think>...
âœ“ æµä¸­æ‰¾åˆ° reasoning_content
```
â†’ **ç»“è®º**: API å·¥ä½œæ­£å¸¸ï¼Œé—®é¢˜åœ¨åº”ç”¨

#### âŒ é—®é¢˜çš„è¾“å‡º
```
âœ— æ–¹æ³•1 (hasattr): æœªæ‰¾åˆ°
âœ— æ–¹æ³•2 (__dict__): æœªæ‰¾åˆ°
âœ— æ–¹æ³•3 (model_dump): æœªæ‰¾åˆ°
âœ— reasoning_content ä¸åœ¨ JSON ä¸­
âœ— æµä¸­æœªæ‰¾åˆ° reasoning_content
```
â†’ **ç»“è®º**: API ä¸è¿”å›æ•°æ®ï¼Œéœ€è¦æ£€æŸ¥é…ç½®

---

## ğŸ¯ å®Œæ•´è¯Šæ–­å†³ç­–æ ‘

```
é—®é¢˜: çœ‹ä¸åˆ°æ€è€ƒå†…å®¹
   â†“
è¿è¡Œ check_reasoning_flow.py
   â†“
   â”œâ”€ API è¿”å› reasoning_content?
   â”‚  â”œâ”€ æ˜¯ â†’ é—®é¢˜åœ¨åº”ç”¨ä¾§
   â”‚  â”‚    â”œâ”€ æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
   â”‚  â”‚    â”œâ”€ é‡å¯åº”ç”¨
   â”‚  â”‚    â”œâ”€ æ£€æŸ¥ [DEBUG] æ—¥å¿—
   â”‚  â”‚    â””â”€ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
   â”‚  â”‚
   â”‚  â””â”€ å¦ â†’ é—®é¢˜åœ¨ API é…ç½®
   â”‚       â”œâ”€ æ£€æŸ¥ API å¯†é’¥
   â”‚       â”œâ”€ éªŒè¯ Base URL
   â”‚       â”œâ”€ ç¡®è®¤æ¨¡å‹åç§°
   â”‚       â””â”€ è”ç³» NetMind æ”¯æŒ
```

---

## ğŸ“ å¦‚æœé—®é¢˜æ˜¯ API é…ç½®

### æ£€æŸ¥é¡¹

1. **API å¯†é’¥**
   ```
   åœ¨ NetMind æ§åˆ¶é¢æ¿éªŒè¯
   ç¡®ä¿æ²¡æœ‰è¿‡æœŸ
   ```

2. **Base URL**
   ```
   åº”è¯¥æ˜¯: https://api.netmind.ai/inference-api/openai/v1
   æˆ–å…¶ä»–æœ‰æ•ˆçš„ NetMind URL
   ```

3. **æ¨¡å‹åç§°**
   ```
   åº”è¯¥æ˜¯: deepseek-ai/DeepSeek-R1
   æˆ–å…¶ä»–æ˜ç¡®æ”¯æŒæ¨ç†çš„æ¨¡å‹
   ```

4. **ç½‘ç»œè¿æ¥**
   ```bash
   curl -I https://api.netmind.ai/inference-api/openai/v1/models \
     -H "Authorization: Bearer YOUR_KEY"
   # åº”è¯¥è¿”å› 200 OK
   ```

### è§£å†³æ­¥éª¤

1. ç¡®è®¤ API å¯†é’¥æœ‰æ•ˆ
2. æµ‹è¯• API è¿æ¥ (ä½¿ç”¨ curl æˆ– check_reasoning_flow.py)
3. å¦‚æœä»ä¸å·¥ä½œï¼Œè”ç³» NetMind æ”¯æŒ
4. æä¾›ä»¥ä¸‹ä¿¡æ¯ç»™ NetMind:
   - API å¯†é’¥å‰åå„ 4 ä¸ªå­—ç¬¦ (éšè—ä¸­é—´éƒ¨åˆ†)
   - è´¦æˆ·çº§åˆ«å’Œé…é¢
   - ä½¿ç”¨çš„æ¨¡å‹åç§°

---

## ğŸ“ å¦‚æœé—®é¢˜æ˜¯åº”ç”¨ä¾§

### æ£€æŸ¥æ­¥éª¤

1. **éªŒè¯æ—¥å¿—**
   ```bash
   journalctl -u your-app-service -n 100 | grep DEBUG
   ```
   
   åº”è¯¥çœ‹åˆ°:
   ```
   [DEBUG] Making API call with model: deepseek-ai/DeepSeek-R1
   [DEBUG] Response message type: ...
   [DEBUG] âœ“ Has reasoning_content: ...
   ```

2. **æ£€æŸ¥æµè§ˆå™¨å¼€å‘å·¥å…·**
   ```
   æ‰“å¼€ F12
   åˆ‡æ¢åˆ° Network æ ‡ç­¾
   å‘é€æ¶ˆæ¯
   æŸ¥æ‰¾ /api/v1/chat/completions è¯·æ±‚
   ç‚¹å‡»è¯¥è¯·æ±‚
   æŸ¥çœ‹ Response æ ‡ç­¾
   
   åº”è¯¥çœ‹åˆ°:
   {"choices": [{"delta": {"reasoning_content": "..."}}]}
   ```

3. **æ¸…é™¤ç¼“å­˜**
   ```
   Ctrl+Shift+Delete
   é€‰æ‹©"å…¨éƒ¨æ—¶é—´"
   ç¡®ä¿å‹¾é€‰äº† Cookies å’Œ Cached images
   ```

4. **é‡å¯æµè§ˆå™¨å’Œåº”ç”¨**
   ```bash
   systemctl restart your-app-service
   ```

---

## ğŸš¨ æœ€åçš„æ‰‹æ®µ

å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½è§£å†³:

### 1. å®Œæ•´é‡ç½®
```bash
# 1. åœæ­¢åº”ç”¨
systemctl stop your-app-service

# 2. æ¸…é™¤æ‰€æœ‰ç¼“å­˜
rm -rf /tmp/*
rm -rf ~/.cache/*

# 3. æ›´æ–°ä¾èµ–
pip install --upgrade openai

# 4. é‡å¯åº”ç”¨
systemctl start your-app-service
```

### 2. éªŒè¯éƒ¨ç½²
```bash
# ç¡®ä¿æœ€æ–°ä»£ç å·²éƒ¨ç½²
git status
# åº”è¯¥çœ‹åˆ°æ²¡æœ‰æœªæäº¤çš„æ”¹åŠ¨

# æˆ–å¼ºåˆ¶æ‹‰å–
git fetch origin
git reset --hard origin/fix-ai-thinking-support-remove-leaked-api-key
```

### 3. è¯¦ç»†æ—¥å¿—
```bash
# å¯ç”¨æœ€è¯¦ç»†çš„æ—¥å¿—
systemctl stop your-app-service

# åœ¨å‰å°è¿è¡Œä»¥çœ‹åˆ°æ‰€æœ‰è¾“å‡º
python run.py

# åœ¨èŠå¤©ä¸­å‘é€æ¶ˆæ¯
# æŸ¥çœ‹å®Œæ•´çš„ [DEBUG] è¾“å‡º
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### æ”¶é›†è¯Šæ–­ä¿¡æ¯
å¦‚æœè¿˜æ˜¯è§£å†³ä¸äº†ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯:

1. check_reasoning_flow.py çš„å®Œæ•´è¾“å‡º
2. åº”ç”¨çš„ [DEBUG] æ—¥å¿—
3. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯
4. ä½¿ç”¨çš„æ¨¡å‹åç§°
5. æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬

### è”ç³»æ¸ é“
- æŸ¥çœ‹æ–‡æ¡£: TROUBLESHOOTING_REASONING.md
- è¿è¡Œè¯Šæ–­: check_reasoning_flow.py
- æŸ¥çœ‹æ—¥å¿—: journalctl

---

## âœ… éªŒè¯æˆåŠŸçš„æ ‡å¿—

çœ‹åˆ°ä»¥ä¸‹æ ‡å¿—è¡¨ç¤ºä¿®å¤æˆåŠŸ:

âœ“ check_reasoning_flow.py æ˜¾ç¤ºæ‰¾åˆ° reasoning_content
âœ“ æ—¥å¿—ä¸­æœ‰ [DEBUG] âœ“ Has reasoning_content æ¶ˆæ¯
âœ“ æµè§ˆå™¨å¼€å‘å·¥å…·çœ‹åˆ°å“åº”ä¸­æœ‰ reasoning_content
âœ“ èŠå¤©ç•Œé¢æ˜¾ç¤º"(æ¨¡å‹æ­£åœ¨æ€è€ƒ...)"
âœ“ å®Œæ•´çš„æ€è€ƒè¿‡ç¨‹æ˜¾ç¤ºåœ¨å¯¹è¯ä¸­

---

**æœ€åæ›´æ–°**: 2024-11-26  
**çŠ¶æ€**: æ‰€æœ‰è¯Šæ–­å·¥å…·å·²å°±ç»ª
